<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>게시물 수정</title>
    <link rel="stylesheet" href="/css/newPost.css">
    <link rel="stylesheet" href="/css/header.css">
</head>
<body>
<div th:replace="~{view/header :: header}"></div>

<div class="post-container">
    <header>
        <h1>게시물 수정</h1>
    </header>
    <form th:action="@{/posts/update/{id}(id=${post.postId})}" method="post" enctype="multipart/form-data">
        <label for="title">제목:</label>
        <input type="text" id="title" name="title" th:value="${post.title}" required>

        <label for="content">내용:</label>
        <textarea id="content" name="content" th:text="${post.content}" required></textarea>

        <label for="tags">태그 (쉼표로 구분):</label>
        <input type="text" id="tags" th:value="${post.tags}" name="tags">

        <label for="images">이미지 업로드:</label>
        <input type="file" id="images" name="image" th:value="${post.images}" multiple>

        <label for="published">임시글 설정:</label>
        <div class="toggle-switch">
            <input type="checkbox" id="published" name="published">
            <span class="slider"></span>
        </div>

        <label for="status">공개 설정:</label>
        <div class="toggle-switch">
            <input type="checkbox" id="status" name="status">
            <span class="slider"></span>
        </div>

        <input type="submit" value="게시물 작성">
    </form>
</div>
</div>
</body>
<script>

    function toggleDropdown() {
        var dropdown = document.getElementById('dropdown-content');
        dropdown.style.display = (dropdown.style.display === 'none' || dropdown.style.display === '') ? 'block' : 'none';
    }

    var profilePics = document.querySelectorAll('.profile-pic');
    profilePics.forEach(function(pic) {
        pic.addEventListener('click', toggleDropdown);
    });


    document.addEventListener('click', function(event) {
        var isClickInside = document.querySelector('.header-right').contains(event.target);
        if (!isClickInside) {
            var dropdown = document.getElementById('dropdown-content');
            dropdown.style.display = 'none';
        }
    });

    // Handle form submission to include toggle values
    document.getElementById('postForm').addEventListener('submit', function(event) {
        var published = document.getElementById('published').checked;
        var status = document.getElementById('status').checked;

        // Append hidden inputs with toggle values to the form
        var form = event.target;
        var publishedInput = document.createElement('input');
        publishedInput.type = 'hidden';
        publishedInput.name = 'published';
        publishedInput.value = published ? 'true' : 'false';

        var statusInput = document.createElement('input');
        statusInput.type = 'hidden';
        statusInput.name = 'status';
        statusInput.value = status ? 'true' : 'false';

        form.appendChild(publishedInput);
        form.appendChild(statusInput);
    });

    // Toggle switches
    document.querySelectorAll('.toggle-switch').forEach(function(toggle) {
        toggle.addEventListener('click', function(event) {
            if (event.target.classList.contains('slider')) {
                var input = this.querySelector('input');
                input.checked = !input.checked;
                var slider = input.nextElementSibling;
                slider.style.backgroundColor = input.checked ? '#007bff' : '#ccc';
                slider.querySelector(':before').style.transform = input.checked ? 'translateX(26px)' : 'translateX(0)';
            }
        });
    });
</script>
</html>